================
ARQUIVO: C:\Users\RvB\OneDrive\Área de Trabalho\TADS\DailyDiet\backend\src\server.js
================
const express = require('express');
const cors = require('cors');
const { v4: uuidv4 } = require('uuid');

const app = express();
app.use(express.json());
app.use(cors());

// --- BANCO DE DADOS EM MEMÃ“RIA (Arrays) ---
// Como nÃ£o usamos banco real, esses dados somem ao reiniciar o servidor
const users = [];
const meals = [];

// --- MIDDLEWARE (VerificaÃ§Ã£o de UsuÃ¡rio) ---
// Regra: Identificar o usuÃ¡rio entre as requisiÃ§Ãµes pelo Header 'user-id'
function checkUserExists(req, res, next) {
  const userId = req.headers['user-id']; 
  
  if (!userId) {
    return res.status(401).json({ error: 'Unauthorized: User ID missing' });
  }

  const user = users.find(u => u.id === userId);
  
  if (!user) {
    return res.status(401).json({ error: 'Unauthorized: User not found' });
  }

  req.user = user; // Repassa o usuÃ¡rio encontrado para as rotas
  next();
}

// --- ROTAS ---

// 1. Login (SimulaÃ§Ã£o de SessÃ£o)
// Verifica se o e-mail existe e retorna os dados do usuÃ¡rio (incluindo ID)
app.post('/sessions', (req, res) => {
  const { email } = req.body;
  
  const user = users.find(u => u.email === email);
  
  if (!user) {
    return res.status(404).json({ error: 'UsuÃ¡rio nÃ£o encontrado. Crie uma conta.' });
  }
  
  return res.json(user);
});

// 2. Pegar dados do usuÃ¡rio logado (Perfil)
// Usado pelo Frontend para exibir "OlÃ¡, [Nome]" no Header
app.get('/me', checkUserExists, (req, res) => {
  return res.json(req.user);
});

// 3. Criar UsuÃ¡rio (Cadastro)
app.post('/users', (req, res) => {
  const { name, email } = req.body;

  // Verifica se jÃ¡ existe um usuÃ¡rio com esse e-mail
  const userAlreadyExists = users.find(user => user.email === email);
  if (userAlreadyExists) {
    return res.status(400).json({ error: 'User already exists' });
  }

  const user = { id: uuidv4(), name, email };
  users.push(user);
  
  return res.status(201).json(user);
});

// 4. Registrar uma refeiÃ§Ã£o
app.post('/meals', checkUserExists, (req, res) => {
  const { name, description, date, isOnDiet } = req.body;
  
  const meal = {
    id: uuidv4(),
    user_id: req.user.id, // Relaciona a refeiÃ§Ã£o ao usuÃ¡rio logado
    name,
    description,
    date, 
    isOnDiet // boolean: true ou false
  };

  meals.push(meal);
  return res.status(201).json(meal);
});

// 5. Listar todas as refeiÃ§Ãµes de um usuÃ¡rio
app.get('/meals', checkUserExists, (req, res) => {
  // Filtra apenas as refeiÃ§Ãµes do usuÃ¡rio que estÃ¡ chamando a API
  const userMeals = meals.filter(m => m.user_id === req.user.id);
  return res.json(userMeals);
});

// 6. Visualizar uma Ãºnica refeiÃ§Ã£o
app.get('/meals/:id', checkUserExists, (req, res) => {
  const { id } = req.params;
  
  // Garante que a refeiÃ§Ã£o pertenÃ§a ao usuÃ¡rio logado
  const meal = meals.find(m => m.id === id && m.user_id === req.user.id);
  
  if (!meal) return res.status(404).json({ error: 'Meal not found' });
  return res.json(meal);
});

// 7. Editar uma refeiÃ§Ã£o
app.put('/meals/:id', checkUserExists, (req, res) => {
  const { id } = req.params;
  const { name, description, date, isOnDiet } = req.body;
  
  const mealIndex = meals.findIndex(m => m.id === id && m.user_id === req.user.id);
  
  if (mealIndex < 0) return res.status(404).json({ error: 'Meal not found' });

  // Atualiza os dados mantendo o ID e o user_id originais
  meals[mealIndex] = { 
    ...meals[mealIndex], 
    name, 
    description, 
    date, 
    isOnDiet 
  };
  
  return res.json(meals[mealIndex]);
});

// 8. Apagar uma refeiÃ§Ã£o
app.delete('/meals/:id', checkUserExists, (req, res) => {
  const { id } = req.params;
  
  const mealIndex = meals.findIndex(m => m.id === id && m.user_id === req.user.id);
  
  if (mealIndex < 0) return res.status(404).json({ error: 'Meal not found' });

  meals.splice(mealIndex, 1);
  return res.status(204).send();
});

// 9. Recuperar mÃ©tricas de um usuÃ¡rio
app.get('/metrics', checkUserExists, (req, res) => {
  const userMeals = meals
    .filter(m => m.user_id === req.user.id)
    .sort((a, b) => new Date(a.date) - new Date(b.date));

  const totalMeals = userMeals.length;
  const totalInDiet = userMeals.filter(m => m.isOnDiet).length;
  const totalOutDiet = userMeals.filter(m => !m.isOnDiet).length;

  // LÃ³gica para calcular a melhor sequÃªncia
  let bestSequence = 0;
  let currentSequence = 0;

  userMeals.forEach(meal => {
    if (meal.isOnDiet) {
      currentSequence++;
      if (currentSequence > bestSequence) {
        bestSequence = currentSequence;
      }
    } else {
      currentSequence = 0;
    }
  });

  return res.json({
    totalMeals,
    totalInDiet,
    totalOutDiet,
    bestSequence
  });
});

// Inicia o servidor
app.listen(3333, () => console.log('Server running on port 3333 ðŸš€'));
================
ARQUIVO: C:\Users\RvB\OneDrive\Área de Trabalho\TADS\DailyDiet\backend\package.json
================
{
  "name": "backend",
  "version": "1.0.0",
  "main": "index.js",
  "scripts": {
    "dev": "node --watch src/server.js",
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "cors": "^2.8.5",
    "express": "^5.1.0",
    "uuid": "^13.0.0"
  },
  "description": ""
}
================
ARQUIVO: C:\Users\RvB\OneDrive\Área de Trabalho\TADS\DailyDiet\frontend\src\components\Footer\index.jsx
================
================
ARQUIVO: C:\Users\RvB\OneDrive\Área de Trabalho\TADS\DailyDiet\frontend\src\pages\Home\index.jsx
================
import { useState, useEffect } from 'react';
import styled from 'styled-components';
import api from '../../services/api';
import { Link, useNavigate } from 'react-router-dom';
import { Plus, ChartBar } from 'phosphor-react';

const Container = styled.div`
  padding: 2rem;
  max-width: 700px;
  margin: 0 auto;
`;

const Header = styled.header`
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
  
  div {
    display: flex;
    flex-direction: column;
  }
  
  h2 { font-size: 1.5rem; color: ${({ theme }) => theme.COLORS.GRAY_700}; }
  span { color: ${({ theme }) => theme.COLORS.GRAY_600}; font-size: 1rem; }
  
  img { width: 50px; height: 50px; border-radius: 50%; border: 2px solid ${({ theme }) => theme.COLORS.GRAY_700}; }
`;

const Button = styled.button`
  background: ${({ theme }) => theme.COLORS.GRAY_600};
  color: white;
  border: 0;
  padding: 12px 24px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: bold;
  
  &:hover { filter: brightness(0.9); }
`;

const PercentCard = styled(Link)`
  background: ${({ theme }) => theme.COLORS.GREEN_LIGHT};
  padding: 20px;
  border-radius: 8px;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-decoration: none;
  color: inherit;
  margin-bottom: 2rem;

  h1 { font-size: 32px; color: ${({ theme }) => theme.COLORS.GRAY_700}; }
  span { color: ${({ theme }) => theme.COLORS.GRAY_600}; font-size: 14px; }
`;

// O MealCard agora Ã© clicÃ¡vel, entÃ£o adicionamos cursor pointer
const MealCard = styled.div`
  padding: 16px;
  border: 1px solid ${({ theme }) => theme.COLORS.GRAY_300};
  margin-bottom: 12px;
  border-radius: 6px;
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
  transition: background 0.2s;

  &:hover { background: ${({ theme }) => theme.COLORS.GRAY_300}; }
  
  strong { flex: 1; color: ${({ theme }) => theme.COLORS.GRAY_700}; }
  
  .status {
    width: 14px; 
    height: 14px; 
    border-radius: 50%;
    background: ${({ isOnDiet, theme }) => isOnDiet ? theme.COLORS.GREEN_DARK : theme.COLORS.RED_DARK};
  }
`;

export function Home() {
  const [meals, setMeals] = useState([]);
  const [metrics, setMetrics] = useState({});
  const [user, setUser] = useState({ name: 'Carregando...' }); // Estado para o usuÃ¡rio
  const navigate = useNavigate();

  async function loadData() {
    try {
      // Agora buscamos tambÃ©m o /me
      const [mealsRes, metricsRes, userRes] = await Promise.all([
        api.get('/meals'),
        api.get('/metrics'),
        api.get('/me')
      ]);
      setMeals(mealsRes.data);
      setMetrics(metricsRes.data);
      setUser(userRes.data);
    } catch (error) {
      console.error("Erro ao carregar dados", error);
    }
  }

  useEffect(() => { loadData(); }, []);

  const percentInDiet = metrics.totalMeals > 0 
    ? ((metrics.totalInDiet / metrics.totalMeals) * 100).toFixed(2) 
    : 0;

  return (
    <Container>
      <Header>
        <div>
           <span>OlÃ¡,</span>
           <h2>{user.name}</h2>
        </div>
        <img src="https://github.com/rocketseat.png" alt="Profile"/>
      </Header>

      <PercentCard to="/metrics">
        <h1>{percentInDiet}%</h1>
        <span>das refeiÃ§Ãµes dentro da dieta</span>
        <ChartBar size={24} style={{marginTop: 10, color: '#639339'}}/>
      </PercentCard>

      <p style={{marginBottom: 10}}>RefeiÃ§Ãµes</p>
      <Link to="/new" style={{textDecoration: 'none'}}>
        <Button style={{width: '100%', marginBottom: 20}}>
          <Plus size={18} /> Nova refeiÃ§Ã£o
        </Button>
      </Link>

      {meals.map(meal => (
        // Ao clicar no card, vai para a pÃ¡gina de detalhes
        <MealCard 
          key={meal.id} 
          isOnDiet={meal.isOnDiet}
          onClick={() => navigate(`/meal/${meal.id}`)}
        >
          <span>{new Date(meal.date).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
          <div style={{height: 20, width: 1, background: '#ddd'}}></div>
          <strong>{meal.name}</strong>
          <div className="status"></div>
        </MealCard>
      ))}
    </Container>
  );
}
================
ARQUIVO: C:\Users\RvB\OneDrive\Área de Trabalho\TADS\DailyDiet\frontend\src\pages\MealDetails\index.jsx
================
import { useState, useEffect } from 'react';
import styled from 'styled-components';
import api from '../../services/api';
import { useParams, useNavigate, Link } from 'react-router-dom';
import { ArrowLeft, PencilSimple, Trash } from 'phosphor-react';

const Container = styled.div`
  background: ${({ theme, isOnDiet }) => isOnDiet ? theme.COLORS.GREEN_LIGHT : theme.COLORS.RED_LIGHT};
  height: 100vh;
  display: flex;
  flex-direction: column;
`;

const Header = styled.div`
  padding: 2rem;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  
  font-weight: bold;
  font-size: 1.5rem;
  color: ${({ theme }) => theme.COLORS.GRAY_700};

  a { position: absolute; left: 2rem; }
`;

const Content = styled.div`
  background: white;
  border-radius: 20px 20px 0 0;
  padding: 2rem;
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  max-width: 700px;
  width: 100%;
  margin: 0 auto;
`;

const Title = styled.h1`
  font-size: 1.5rem;
  color: ${({ theme }) => theme.COLORS.GRAY_700};
`;

const Description = styled.p`
  font-size: 1rem;
  color: ${({ theme }) => theme.COLORS.GRAY_600};
`;

const DateInfo = styled.div`
  h3 { font-size: 1rem; color: ${({ theme }) => theme.COLORS.GRAY_700}; margin-bottom: 5px; }
  p { font-size: 1.1rem; color: ${({ theme }) => theme.COLORS.GRAY_500}; }
`;

const Tag = styled.div`
  background: ${({ theme }) => theme.COLORS.GRAY_300};
  padding: 8px 16px;
  border-radius: 1000px;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  align-self: flex-start;
  font-size: 0.9rem;

  .dot {
    width: 8px; height: 8px; border-radius: 50%;
    background: ${({ isOnDiet, theme }) => isOnDiet ? theme.COLORS.GREEN_DARK : theme.COLORS.RED_DARK};
  }
`;

const Footer = styled.div`
  margin-top: auto;
  display: flex;
  flex-direction: column;
  gap: 10px;
`;

const Button = styled.button`
  background: ${({ theme, variant }) => variant === 'secondary' ? 'transparent' : theme.COLORS.GRAY_600};
  color: ${({ theme, variant }) => variant === 'secondary' ? theme.COLORS.GRAY_700 : 'white'};
  border: ${({ theme, variant }) => variant === 'secondary' ? `1px solid ${theme.COLORS.GRAY_700}` : '0'};
  padding: 16px;
  border-radius: 6px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  
  &:hover { filter: brightness(0.9); }
`;

export function MealDetails() {
  const [meal, setMeal] = useState(null);
  const { id } = useParams();
  const navigate = useNavigate();

  useEffect(() => {
    api.get(`/meals/${id}`)
      .then(response => setMeal(response.data))
      .catch(() => {
         alert("Erro ao carregar refeiÃ§Ã£o.");
         navigate('/');
      });
  }, [id, navigate]);

  async function handleDelete() {
    if (window.confirm("Deseja excluir esta refeiÃ§Ã£o?")) {
      await api.delete(`/meals/${id}`);
      navigate('/');
    }
  }

  if (!meal) return <div style={{padding: 20}}>Carregando...</div>;

  return (
    <Container isOnDiet={meal.isOnDiet}>
      <Header>
        <Link to="/"><ArrowLeft size={24} color="#333"/></Link>
        <span>RefeiÃ§Ã£o</span>
      </Header>

      <Content>
        <div>
          <Title>{meal.name}</Title>
          <Description>{meal.description}</Description>
        </div>

        <DateInfo>
          <h3>Data e hora</h3>
          <p>{new Date(meal.date).toLocaleString()}</p>
        </DateInfo>

        <Tag isOnDiet={meal.isOnDiet}>
          <div className="dot"></div>
          {meal.isOnDiet ? "Dentro da dieta" : "Fora da dieta"}
        </Tag>

        <Footer>
          <Button onClick={() => navigate(`/edit/${meal.id}`)}>
             <PencilSimple size={18} /> Editar refeiÃ§Ã£o
          </Button>
          <Button variant="secondary" onClick={handleDelete}>
             <Trash size={18} /> Excluir refeiÃ§Ã£o
          </Button>
        </Footer>
      </Content>
    </Container>
  );
}
================
ARQUIVO: C:\Users\RvB\OneDrive\Área de Trabalho\TADS\DailyDiet\frontend\src\pages\Metrics\index.jsx
================
import { useState, useEffect } from 'react';
import styled from 'styled-components';
import api from '../../services/api';
import { Link } from 'react-router-dom';
import { ArrowLeft } from 'phosphor-react';

const Container = styled.div`
  background: ${({ theme }) => theme.COLORS.GREEN_LIGHT};
  min-height: 100vh;
  display: flex;       /* Garante que os filhos se comportem bem */
  flex-direction: column;
`;

const Header = styled.header`
  padding: 2rem;
  text-align: center;
  position: relative;
  h1 { font-size: 2rem; color: ${({ theme }) => theme.COLORS.GRAY_700}; }
  p { color: ${({ theme }) => theme.COLORS.GRAY_600}; }
`;

const Content = styled.div`
  background: white;
  border-radius: 20px 20px 20px 20px;
  padding: 2rem;
  flex: 0; 
  display: flex;
  flex-direction: column;
  gap: 1rem;
  
  /* CentralizaÃ§Ã£o Horizontal */
  max-width: 700px;
  width: 100%;
  margin: 0 auto; 
`;

const Card = styled.div`
  background: ${({ bg }) => bg || '#EFF0F0'};
  padding: 1.5rem;
  border-radius: 8px;
  text-align: center;
  
  h2 { font-size: 1.5rem; color: #1B1D1E; margin-bottom: 5px; }
  p { font-size: 0.9rem; color: #333638; }
`;

export function Metrics() {
  const [metrics, setMetrics] = useState(null);

  useEffect(() => {
    api.get('/metrics').then(res => setMetrics(res.data));
  }, []);

  if (!metrics) return <div style={{padding: 20}}>Carregando...</div>;

  const percentage = metrics.totalMeals > 0 
    ? ((metrics.totalInDiet / metrics.totalMeals) * 100).toFixed(2) 
    : 0;

  return (
    <Container>
      <Header>
        <Link to="/" style={{position: 'absolute', left: 20, top: 25}}>
          <ArrowLeft size={24} color="#639339"/>
        </Link>
        <h1>{percentage}%</h1>
        <p>das refeiÃ§Ãµes dentro da dieta</p>
      </Header>

      <Content>
        <h3 style={{textAlign: 'center', marginBottom: 10}}>EstatÃ­sticas gerais</h3>
        
        <Card>
          <h2>{metrics.bestSequence}</h2>
          <p>melhor sequÃªncia de pratos dentro da dieta</p>
        </Card>
        
        <Card>
          <h2>{metrics.totalMeals}</h2>
          <p>refeiÃ§Ãµes registradas</p>
        </Card>

        <div style={{display: 'flex', gap: 10}}>
          <Card bg="#E5F0DB" style={{flex: 1}}>
             <h2>{metrics.totalInDiet}</h2>
             <p>dentro da dieta</p>
          </Card>
          <Card bg="#F4E6E7" style={{flex: 1}}>
             <h2>{metrics.totalOutDiet}</h2>
             <p>fora da dieta</p>
          </Card>
        </div>
      </Content>
    </Container>
  );
}
================
ARQUIVO: C:\Users\RvB\OneDrive\Área de Trabalho\TADS\DailyDiet\frontend\src\pages\NewMeal\index.jsx
================
import { useState, useEffect } from 'react';
import styled from 'styled-components';
import api from '../../services/api';
import { useNavigate, Link, useParams } from 'react-router-dom';
import { ArrowLeft } from 'phosphor-react';

const Container = styled.div`
  background: ${({ theme }) => theme.COLORS.GRAY_300};
  height: 100vh;
`;

const Header = styled.div`
  padding: 2rem;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  
  font-weight: bold;
  font-size: 1.5rem;
  color: ${({ theme }) => theme.COLORS.GRAY_700};

  a {
    position: absolute;
    left: 2rem;
  }
`;

const Form = styled.form`
  background: white;
  border-radius: 20px 20px 0 0;
  padding: 2rem;
  height: 100%;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;

  input, textarea, select {
    padding: 14px;
    border-radius: 6px;
    border: 1px solid #ddd;
    font-size: 1rem;
  }
  
  label { font-weight: bold; font-size: 0.9rem; color: #444; }
`;

const Button = styled.button`
  background: ${({ theme }) => theme.COLORS.GRAY_600};
  color: white;
  border: 0;
  padding: 16px;
  border-radius: 6px;
  font-weight: bold;
  margin-top: auto;
  
  &:hover { background: ${({ theme }) => theme.COLORS.GRAY_700}; }
`;

export function NewMeal() {
  const [name, setName] = useState('');
  const [description, setDescription] = useState('');
  const [isOnDiet, setIsOnDiet] = useState("yes");
  
  // [NOVO] Estado para data e hora
  const [dateTime, setDateTime] = useState(''); 
  
  const navigate = useNavigate();
  const { id } = useParams(); 
  const isEditing = !!id; 

  useEffect(() => {
    if (isEditing) {
      api.get(`/meals/${id}`)
        .then(response => {
          const { name, description, isOnDiet, date } = response.data;
          setName(name);
          setDescription(description);
          setIsOnDiet(isOnDiet ? "yes" : "no");
          
          // Formata a data para o input do HTML (YYYY-MM-DDTHH:mm)
          // O slice(0,16) corta os segundos e milisegundos
          if (date) {
             const formattedDate = new Date(date).toISOString().slice(0, 16);
             setDateTime(formattedDate);
          }
        })
        .catch(() => navigate('/home'));
    }
  }, [id, isEditing, navigate]);

  async function handleSubmit(e) {
    e.preventDefault();
    try {
      // Se o usuÃ¡rio nÃ£o preencher data, usa a atual
      const finalDate = dateTime ? new Date(dateTime).toISOString() : new Date().toISOString();

      const dataToSend = {
        name,
        description,
        date: finalDate, 
        isOnDiet: isOnDiet === "yes"
      };

      if (isEditing) {
          await api.put(`/meals/${id}`, dataToSend);
          alert('RefeiÃ§Ã£o atualizada!');
      } else {
          await api.post('/meals', dataToSend);
          alert('RefeiÃ§Ã£o criada!');
      }
      
      navigate('/home');
    } catch (error) {
      alert("Erro ao salvar.");
    }
  }

  return (
    <Container>
      <Header>
        {/* Link volta para /home agora */}
        <Link to="/home"><ArrowLeft size={24} color="#333"/></Link>
        <span>{isEditing ? 'Editar refeiÃ§Ã£o' : 'Nova refeiÃ§Ã£o'}</span>
      </Header>
      
      <Form onSubmit={handleSubmit}>
        <div style={{display: 'flex', flexDirection: 'column', gap: 5}}>
          <label>Nome</label>
          <input required value={name} onChange={e => setName(e.target.value)} />
        </div>

        <div style={{display: 'flex', flexDirection: 'column', gap: 5}}>
          <label>DescriÃ§Ã£o</label>
          <textarea required rows={3} value={description} onChange={e => setDescription(e.target.value)} />
        </div>

        {/* [NOVO] Campo de Data e Hora */}
        <div style={{display: 'flex', flexDirection: 'column', gap: 5}}>
          <label>Data e Hora</label>
          <input 
            type="datetime-local"
            required
            value={dateTime} 
            onChange={e => setDateTime(e.target.value)} 
          />
        </div>

        <div style={{display: 'flex', flexDirection: 'column', gap: 5}}>
           <label>EstÃ¡ dentro da dieta?</label>
           <select value={isOnDiet} onChange={e => setIsOnDiet(e.target.value)}>
             <option value="yes">Sim</option>
             <option value="no">NÃ£o</option>
           </select>
        </div>

        <Button type="submit">{isEditing ? 'Salvar alteraÃ§Ãµes' : 'Cadastrar RefeiÃ§Ã£o'}</Button>
      </Form>
    </Container>
  );
}
================
ARQUIVO: C:\Users\RvB\OneDrive\Área de Trabalho\TADS\DailyDiet\frontend\src\pages\SignIn\index.jsx
================
import { useState } from 'react';
import styled from 'styled-components';
import api from '../../services/api';
import { useNavigate } from 'react-router-dom';
import { ForkKnife } from 'phosphor-react';

const Container = styled.div`
  height: 100vh;
  background: ${({ theme }) => theme.COLORS.GRAY_300};
  display: flex;
  align-items: center;
  justify-content: center;
`;

const Card = styled.div`
  background: white;
  padding: 3rem;
  border-radius: 8px;
  width: 100%;
  max-width: 400px;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  text-align: center;
`;

const Logo = styled.div`
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  font-size: 2rem;
  font-weight: bold;
  color: ${({ theme }) => theme.COLORS.GRAY_700};
  margin-bottom: 1rem;
`;

const Input = styled.input`
  padding: 14px;
  border-radius: 6px;
  border: 1px solid #ddd;
  font-size: 1rem;
  width: 100%;
`;

const Button = styled.button`
  background: ${({ theme, variant }) => variant === 'secondary' ? 'transparent' : theme.COLORS.GRAY_600};
  color: ${({ theme, variant }) => variant === 'secondary' ? theme.COLORS.GRAY_700 : 'white'};
  border: ${({ theme, variant }) => variant === 'secondary' ? `1px solid ${theme.COLORS.GRAY_700}` : '0'};
  padding: 16px;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
  
  &:hover { filter: brightness(0.9); }
`;

export function SignIn() {
  const [email, setEmail] = useState('');
  const [name, setName] = useState(''); // Usado apenas no cadastro
  const [isRegistering, setIsRegistering] = useState(false); // Alterna entre Login e Cadastro
  
  const navigate = useNavigate();

  async function handleAuth() {
    if (!email) return alert("Digite o e-mail");

    try {
      let response;
      
      if (isRegistering) {
        // CADASTRO
        if (!name) return alert("Digite seu nome");
        response = await api.post('/users', { name, email });
        alert("Conta criada com sucesso! FaÃ§a login.");
        setIsRegistering(false); // Volta para tela de login
        return; 
      } else {
        // LOGIN
        response = await api.post('/sessions', { email });
      }

      // Salva o ID e entra na Home
      const user = response.data;
      localStorage.setItem('@dailydiet:userid', user.id);
      navigate('/home');

    } catch (error) {
      if (error.response?.status === 404) {
        alert("UsuÃ¡rio nÃ£o encontrado. Crie uma conta.");
      } else if (error.response?.status === 400) {
        alert("UsuÃ¡rio jÃ¡ existe.");
      } else {
        alert("Erro ao autenticar.");
      }
    }
  }

  return (
    <Container>
      <Card>
        <Logo>
          <ForkKnife size={40} />
          Daily Diet
        </Logo>

        {isRegistering && (
          <Input 
            placeholder="Seu nome" 
            value={name} 
            onChange={e => setName(e.target.value)} 
          />
        )}
        
        <Input 
          placeholder="Seu e-mail" 
          type="email"
          value={email} 
          onChange={e => setEmail(e.target.value)} 
        />

        <Button onClick={handleAuth}>
          {isRegistering ? 'Cadastrar' : 'Entrar'}
        </Button>
        
        <Button variant="secondary" onClick={() => setIsRegistering(!isRegistering)}>
          {isRegistering ? 'JÃ¡ tenho conta' : 'Criar conta'}
        </Button>
      </Card>
    </Container>
  );
}
================
ARQUIVO: C:\Users\RvB\OneDrive\Área de Trabalho\TADS\DailyDiet\frontend\src\routes\app.routes.jsx
================
import { Routes, Route } from 'react-router-dom';
import { SignIn } from '../pages/SignIn'; 
import { Home } from '../pages/Home';
import { NewMeal } from '../pages/NewMeal';
import { MealDetails } from '../pages/MealDetails';
import { Metrics } from '../pages/Metrics';

export function AppRoutes() {
  return (
    <Routes>
      {/* Rota Raiz: Agora Ã© o Login */}
      <Route path="/" element={<SignIn />} />
      
      {/* Rotas protegidas (acessÃ­veis apÃ³s login) */}
      <Route path="/home" element={<Home />} />
      
      {/* CriaÃ§Ã£o e EdiÃ§Ã£o usam o mesmo componente */}
      <Route path="/new" element={<NewMeal />} />
      <Route path="/edit/:id" element={<NewMeal />} />
      
      {/* Detalhes da refeiÃ§Ã£o */}
      <Route path="/meal/:id" element={<MealDetails />} />
      
      {/* MÃ©tricas */}
      <Route path="/metrics" element={<Metrics />} />
    </Routes>
  );
}
================
ARQUIVO: C:\Users\RvB\OneDrive\Área de Trabalho\TADS\DailyDiet\frontend\src\routes\index.jsx
================
import { BrowserRouter } from 'react-router-dom';
import { AppRoutes } from './app.routes';

export function Routes() {
  return (
    <BrowserRouter>
      <AppRoutes />
    </BrowserRouter>
  );
}
================
ARQUIVO: C:\Users\RvB\OneDrive\Área de Trabalho\TADS\DailyDiet\frontend\src\services\api.js
================
import axios from 'axios';

const api = axios.create({
  baseURL: 'http://localhost:3333'
});

// Interceptor simples: Apenas pega o ID do localStorage e envia no cabeÃ§alho
api.interceptors.request.use((config) => {
  const userId = localStorage.getItem('@dailydiet:userid');
  
  if (userId) {
    config.headers['user-id'] = userId;
  }
  
  return config;
});

export default api;
================
ARQUIVO: C:\Users\RvB\OneDrive\Área de Trabalho\TADS\DailyDiet\frontend\src\styles\global.js
================
import { createGlobalStyle } from 'styled-components';

export default createGlobalStyle`
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }
  body {
    background-color: ${({ theme }) => theme.COLORS.BACKGROUND};
    color: ${({ theme }) => theme.COLORS.GRAY_700};
    -webkit-font-smoothing: antialiased;
  }
  body, input, textarea, button {
    font-family: 'Arial', sans-serif;
    font-weight: 400;
    font-size: 1rem;
  }
  button {
    cursor: pointer;
  }
`;
================
ARQUIVO: C:\Users\RvB\OneDrive\Área de Trabalho\TADS\DailyDiet\frontend\src\styles\theme.js
================
export default {
  COLORS: {
    BACKGROUND: "#FAFAFA",
    WHITE: "#FFFFFF",
    GRAY_700: "#1B1D1E",
    GRAY_600: "#333638",
    GRAY_500: "#5C6265",
    GRAY_400: "#B9BBBC",
    GRAY_300: "#DDDEDF",
    RED_DARK: "#BF3B44",
    RED_LIGHT: "#F4E6E7",
    GREEN_DARK: "#639339",
    GREEN_LIGHT: "#E5F0DB",
  }
};
================
ARQUIVO: C:\Users\RvB\OneDrive\Área de Trabalho\TADS\DailyDiet\frontend\src\main.jsx
================
import React from 'react';
import ReactDOM from 'react-dom/client';
import { ThemeProvider } from 'styled-components';
import GlobalStyles from './styles/global';
import theme from './styles/theme';
import { Routes } from './routes';

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <ThemeProvider theme={theme}>
      <GlobalStyles />
      <Routes />
    </ThemeProvider>
  </React.StrictMode>,
);
================
ARQUIVO: C:\Users\RvB\OneDrive\Área de Trabalho\TADS\DailyDiet\frontend\eslint.config.js
================
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])
================
ARQUIVO: C:\Users\RvB\OneDrive\Área de Trabalho\TADS\DailyDiet\frontend\package.json
================
{
  "name": "frontend",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "axios": "^1.13.2",
    "phosphor-react": "^1.4.1",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.9.6",
    "styled-components": "^6.1.19"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "vite": "^7.2.4"
  }
}
